# 基础构建

## 本节目标

- 手动改造一个 `vue` 项目支持 `TypeScript`

## 初始项目

```
vue init webpack vue-typescript
cd vue-typescript
cnpm i
```

- 国内可以用cnpm
- cnpm安装
```
npm install -g cnpm --registry=https://registry.npm.taobao.org
```

## 加载包

```
cnpm i vue-class-component vue-property-decorator --save
cnpm i ts-loader typescript tslint tslint-loader tslint-config-standard --save-dev
```

## 配置 webpack

- ./build/webpack.base.conf.js

```json

// 入口

entry: {
    app: './src/main.ts'
}

// resolve.extensions

resolve: {
  extensions: ['.js', '.vue', '.json', '.ts'],
  alias: {
    '@': resolve('src')
  }
}

// module.rules

module: {
  rules: [
    {
      test: /\.(js|vue)$/,
      loader: 'eslint-loader',
      enforce: 'pre',
      include: [resolve('src'), resolve('test')],
      options: {
        formatter: require('eslint-friendly-formatter')
      }
    },
// 从这里复制下面的代码就可以了
    {
      test: /\.ts$/,
      exclude: /node_modules/,
      enforce: 'pre',
      loader: 'tslint-loader'
    },
    {
      test: /\.tsx?$/,
      loader: 'ts-loader',
      exclude: /node_modules/,
      options: {
        appendTsSuffixTo: [/\.vue$/],
      }
    },
// 复制以上的
  }
}

```

## 添加 `tsconfig.json`

```json
{
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules"
    ],
    "compilerOptions": {
        "allowSyntheticDefaultImports": true,
        "experimentalDecorators": true,
        "allowJs": true,
        "module": "esnext",
        "target": "es5",
        "moduleResolution": "node",
        "isolatedModules": true,
        "lib": [
            "dom",
            "es5",
            "es6",
            "es7",
            "es2015.promise"
        ],
        "sourceMap": true,
        "pretty": true
    }
}
```

## 添加 `tslint.json`

```json
{
    "extends": "tslint-config-standard",
    "globals": {
        "require": true
    }
}
```

## 创建 `src/vue-shim.d.ts`

让 ts 识别 .vue

```ts
declare module "*.vue" {
    import Vue from "vue";
    export default Vue;
}
```

## 修改 `src/app.vue`

```js
<template>
  <div>
    <input v-model="msg">
    <p>msg: {{ msg }}</p>
    <p>computed msg: {{ computedMsg }}</p>
    <button @click="greet">Greet</button>
  </div>
</template>

<script lang="ts">
  import Vue from 'vue'
  import Component from 'vue-class-component'

  @Component
  export default class App extends Vue {
    // 初始化数据
    msg: string = 'hello word'

    // 声明周期钩子
    mounted () {
      this.greet()
    }

    // 计算属性
    get computedMsg () {
      return 'computed ' + this.msg
    }

    // 方法
    greet () {
      alert('greeting: ' + this.msg)
    }
  }
</script>
```

## 运行

```
npm start
```

